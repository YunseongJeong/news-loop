<!--article í™”ë©´ì„ êµ¬ì„±-->

{% extends 'layout.html' %}

{% block content %}

<div class="article-container">
    <div class="container">
        <h1 class="article-subject"> {{ article.subject }} </h1>
        <p class="article-writer"> {{ article.username }}</p>
        <p class="article-date"> {{ article.created_at }} </p>
        <img class="article-image" src="{{ article.image_path }}"/>
        <p class="article-description"> {{ article.content }} </p>

<!--        ë³¸ì¸ì´ likeë¥¼ ëˆŒë €ëŠ”ì§€ì— ë”°ë¼ ë‹¤ë¥¸ í•¨ìˆ˜ì™€ ì´ëª¨í‹°ì½˜ì„ ì‚¬ìš© -->
        {% if like %}
        <p class="article-like" onclick="unlike()">
            â¤ï¸ {{ likeCount }}
        </p>
        {% else %}
        <p class="article-like" onclick="like()">
            ğŸ¤ {{ likeCount }}
        </p>

        {% endif %}

    </div>
</div>
<div class="container">
    <div class="comment-block">
        <form action="/articles/comments/{{ article.id }}" method="POST">
            <label for="content">comment</label>
            <br>
            <textarea id="content" name="content" rows="6" cols="50" placeholder="ì—¬ê¸°ì— ëŒ“ê¸€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <button type="submit">ì“°ê¸°</button>
            <br>
        </form>
    </div>
    <div class="comment-container">
        {% for comment in comments %}
        <div class="comment-block">
            <h4 class="comment-writer"> {{ comment.username }}</h4>
            <p class="comment-content"> {{ comment.content }} </p>
<!--             ë³¸ì¸ì˜ comment ì¼ ë•Œë§Œ ì‚­ì œ ë²„íŠ¼ í™œì„±í™”-->
            {% if comment.uid == user.id %}
            <button onclick="deleteComment(event)", data-comment-id="{{ comment.id }}"> ì‚­ì œ </button>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}

{% block script %}

<script>
    { // message handler (queryë¡œ ì˜¨ message ì²˜ë¦¬)
        const params = new URLSearchParams(window.location.search);
        const message = params.get('message');
        if (message) {
            alert(decodeURIComponent(message));
        }
    }

    // comment ì‚­ì œ í•¨ìˆ˜
    function deleteComment(e){
        const commentId = e.target.dataset.commentId;
        console.log(commentId);
        axios.delete(`/articles/comments/${commentId}`);
    }

    // ì¢‹ì•„ìš” í•¨ìˆ˜
    function like(){
        const pathname = window.location.pathname;
        const aid = pathname.split('/').pop();
        axios.get(`/articles/like/${aid}`);
    }

    // ì¢‹ì•„ìš” ì·¨ì†Œ í•¨ìˆ˜
    function unlike(){
        const pathname = window.location.pathname;
        const aid = pathname.split('/').pop();
        axios.get(`/articles/unlike/${aid}`);
    }
</script>
{% endblock %}